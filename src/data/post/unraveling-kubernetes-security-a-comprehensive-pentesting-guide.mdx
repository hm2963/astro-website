---
title: "Unraveling Kubernetes Security: A Comprehensive Pentesting Guide"
publishDate: 2024-01-10
excerpt: ""
image: "~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/Unraveling-Kubernetes-Security-cover-image.svg"
category: "Cloud Security"
tags: ["kubernetes", "penetration testing", "cybersecurity"]
author: "Admin"
metadata:
  description: "Explore our concise guide for securing Kubernetes. Learn essential strategies and tools to safeguard containerized apps effectively."
---

import Image from '~/components/common/Image.astro';
import image1 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/1-5.png';
import image2 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/2-7.png';
import image3 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/3-6.png';
import image4 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/4-5.png';
import image5 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/5-6.png';
import image6 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/6-5.png';
import image7 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/7-3.png';
import image8 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/8-4.png';
import image9 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/9-5.png';
import image10 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/10-5.png';
import image11 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/11-5.png';
import image12 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/12-3.png';
import image13 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/13-4.png';
import image14 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/14-4.png';
import image15 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/15-3.png';
import image16 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/16-3.png';
import image17 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/17-4.png';
import image18 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/18-2.png';
import image19 from '~/assets/images/prplbx_images/blog_81_unraveling-kubernetes-security-a-comprehensive-pentesting-guide/19-2.png';

### Introduction

Kubernetes has emerged as the leading container orchestration platform, empowering organizations to manage, deploy, and scale containerized applications with ease. However, the increased adoption of Kubernetes also brings forth new security challenges. In this blog post, we will delve into the intricacies of Kubernetes security and explore the methodologies involved in conducting a penetration test (pentest) to ensure the robustness of your Kubernetes clusters.

### Understanding Kubernetes

#### What is Kubernetes?

Kubernetes, often abbreviated as K8s, is an open-source container orchestration platform that automates the deployment, scaling, and management of containerized applications. It provides a robust framework for container orchestration, ensuring high availability, scalability, and flexibility.

**Key Components**

1.  **Master Node:** Controls and manages the Kubernetes cluster.
2.  **Nodes (Minions):** Worker machines that run containerized applications.
3.  **Pods:** The smallest deployable units that encapsulate one or more containers.
4.  **Services:** Enables communication between various components within the cluster.
5.  **Controllers:** Manage the desired state of the cluster.

### Kubernetes Pentesting

#### Methodologies

**Information Gathering:**

*   Identify the target Kubernetes cluster.
*   Enumerate components, versions, and potential entry points.
*   Gather information on network architecture.

**Authentication and Authorization Testing:**

*   Evaluate the effectiveness of authentication mechanisms.
*   Test authorization controls and role-based access.
*   Probe for weak credentials and access controls.

**Pod Security Testing:**

*   Assess the security of individual pods.
*   Review container configurations for vulnerabilities.
*   Evaluate pod isolation and attack surface.

**Network Security Testing:**

*   Analyze network policies for weaknesses.
*   Test for unauthorized access and lateral movement.
*   Assess the security of inter-pod communication.

**API Security Testing:**

*   Probe Kubernetes APIs for vulnerabilities.
*   Test for injection attacks and unauthorized API access.
*   Evaluate the security of API endpoints.

**Configuration Reviews:**

*   Examine Kubernetes configurations for misconfigurations.
*   Assess the security of resource quotas and limits.
*   Review privilege escalation possibilities.

**Tools**

*   **kube-hunter:** Scan Kubernetes clusters for security vulnerabilities.
*   **kube-bench:** Assess Kubernetes security using the CIS Kubernetes Benchmark.
*   **kubeaudit:** Scan configurations for potential security risks.
*   **KubeSec:** A comprehensive Kubernetes security auditing tool.

### Navigating the Depths of Kubernetes Security Challenges: A Hands-on CTF Exploration

As a result of Nmap scanning, it was seen that some ports were open to the outside. When these ports were then examined, it was understood that Kubernetes is running, for example, 10250 (Kubelet API), and 10259 (kube-scheduler).

<Image src={image1} alt="Nmap Scan Results 1" class="mx-auto my-8" width="600" />
<Image src={image2} alt="Nmap Scan Results 2" class="mx-auto my-8" width="600" />

One of the first steps to check is whether pod information can be accessed anonymously. To do this, go to port 10255 and make a request to the pods’ endpoint.

<Image src={image3} alt="Anonymous Pod Access" class="mx-auto my-8" width="600" />

Direct pod information can be accessed anonymously from outside. Through this avenue, the attacker can collect information about the pods.

After scanning the directory, we were able to identify sensitive directories. As a result of this scan, we detected an endpoint named **“.git-credentials”**.

<Image src={image4} alt="Sensitive Directory Scan" class="mx-auto my-8" width="600" />

From there, it was determined that a file could be downloaded when a request was made to the detected endpoint.

<Image src={image5} alt="File Download" class="mx-auto my-8" width="600" />

When the file type was checked, it was found to be an ASCII file. Afterward, when the file’s content was read, URL-encoded user information was found.

<Image src={image6} alt="ASCII File Content" class="mx-auto my-8" width="600" />

Clear-text user information was accessed by URL decoding.

<Image src={image7} alt="Decoded User Information" class="mx-auto my-8" width="600" />

Since the SSH port is open to the outside, an SSH connection was made to the target system using the user information.

<Image src={image8} alt="SSH Connection" class="mx-auto my-8" width="600" />

The phrase microk8s attracts attention when making an SSH connection.

<Image src={image9} alt="Microk8s" class="mx-auto my-8" width="600" />

Let’s briefly talk about what Microk8s is.

Microk8s is a lightweight and fast Kubernetes (K8s) distribution. It can be installed with a single command and is ready to use with minimal configuration. MicroK8s provides an ideal microservices platform for development, testing, and rapid deployment.

Microk8s can also be seen when the processes running in the background are listed. In addition, some namespace and container ID values can also be seen.

<Image src={image10} alt="Microk8s Processes" class="mx-auto my-8" width="600" />

Some helpful information can be accessed when the Microk8s command is run directly.

<Image src={image11} alt="Microk8s Command" class="mx-auto my-8" width="600" />

Pods can be listed or all information can be listed with the kubectl parameter.

<Image src={image12} alt="List Pods" class="mx-auto my-8" width="600" />

When microk8s privilege escalation was searched on Google, the number [CVE-2019-15789](https://pulsesecurity.co.nz/advisories/microk8s-privilege-escalation) was encountered.

It is written that if a pod with the following features is created, root authority will be accessed on the system.

<Image src={image13} alt="CVE-2019-15789" class="mx-auto my-8" width="600" />

To create a problem-free pod, image information of the pod that was actively running in the background was obtained.

<Image src={image14} alt="Pod Image Information" class="mx-auto my-8" width="600" />

Using this image information, a new YAML file was created using the method described in the blog post. Afterwards, a new pod was created using this YAML file.

<Image src={image15} alt="New YAML File" class="mx-auto my-8" width="600" />
<Image src={image16} alt="Create New Pod" class="mx-auto my-8" width="600" />

When the pods are listed again, it is seen that the new pod is working smoothly.

<Image src={image17} alt="New Pod Running" class="mx-auto my-8" width="600" />

When the bash command was run in the newly created pod, root files were accessed.

<Image src={image18} alt="Root File Access 1" class="mx-auto my-8" width="600" />
<Image src={image19} alt="Root File Access 2" class="mx-auto my-8" width="600" />

### Conclusion

As organizations increasingly rely on Kubernetes for container orchestration, ensuring the security of these clusters becomes paramount. Pentesting Kubernetes environments is a crucial step in identifying and mitigating potential security risks. By understanding the key components and challenges of Kubernetes security and employing detailed testing methodologies, organizations can proactively secure their containerized applications and infrastructure.

Remember, security is an ongoing process, and regularly conducting pentests is essential to staying ahead of potential threats in the ever-evolving landscape of Kubernetes and containerization.